<!DOCTYPE html>
<!-- saved from url=(0047)http://mitchellkember.com/blog/post/ray-tracer/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>How to write a ray tracer</title>

	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes">
	<link rel="stylesheet" href="./orthographic_and_perspective_cameras_files/styles.css">
	<link rel="stylesheet" href="./orthographic_and_perspective_cameras_files/equanimity.css">
	<link rel="stylesheet" href="./orthographic_and_perspective_cameras_files/css">

	
	<script async="" src="./orthographic_and_perspective_cameras_files/analytics.js"></script><script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-61163587-1', 'auto');
	ga('send', 'pageview');
	</script>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
	



<header>
	<nav class="page-nav">
	<ul>
		<li id="go-previous"><a href="http://mitchellkember.com/blog/post/chasing-the-infinite/">«&nbsp;New<span>er</span></a></li><li id="go-home-d"><a href="http://mitchellkember.com/">Home</a></li><li id="go-toc"><a href="http://mitchellkember.com/blog/">Blog</a></li><li id="go-next"><a href="http://mitchellkember.com/blog/post/prisoner-dilemma/">Old<span>er</span>&nbsp;»</a></li>
	</ul>
</nav>

</header>

<article>
	<span class="post-meta">Friday, 24 April 2015</span>
	<h2 class="post-title">How to write a ray tracer</h2>
	
		<h3 class="post-description">An outline of the components of a ray tracer</h3>
	
	<p>In the summer of 2012, I wrote a ray tracer called <a href="https://github.com/mk12/luminosity">Luminosity</a> as my first Haskell project. I’ve worked on other things since, but Luminosity remains my favourite project. If you’re itching to write some code but, after googling “coding project ideas,” digging up that Asteroids clone you never finished, combing through lists of open source projects—still find yourself in a painful discombobulation—then I suggest writing a ray tracer.  The algorithm itself is surprisingly simple, but there are many other details to consider before you can start rendering images. Once those issues are tackled, though, the end results are very rewarding.</p>

<figure>
	
	<img src="./orthographic_and_perspective_cameras_files/luminosity.jpg">
	
		<figcaption>Three spheres and three planes rendered by Luminosity</figcaption>
	
</figure>


<h1 id="overview">Overview</h1>

<p>Ray tracing is a method of <em>rendering</em>, which converts three-dimensional scenes into two-dimensional images. It is used by software such as <a href="http://www.blender.org/">Blender</a> to render still images as well as animated movies (which are simply many still images strung together). Rendering is also important in video games, but quality ray tracing is usually far too slow to maintain one frame per second, much less 60 frames!</p>

<p>The ray tracing algorithm computes the colour of each pixel in the image independently of the others.<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="http://mitchellkember.com/blog/post/ray-tracer/#fn:1">1</a></sup> Imagine the image comes from a rectangular camera sensor placed in the scene, so that all colour information is due to rays of light hitting the sensor elements. If we assume that all light originates from a finite set of light sources in the scene, we can determine the image formed on the sensor by backtracking the light.</p>

<p>We begin with a ray on the sensor pointing towards the scene. We follow the ray in a straight line until it intersects with an object—this is the object seen at that particular pixel in the image. A separate algorithm determines the colour produced by the interaction of each light source with the object material. If the object is reflective, we bounce the ray off it and repeat. This method realistically simulates the way light interacts with materials such as glass and polished metal.</p>

<h1 id="rays-and-surfaces">Rays and surfaces</h1>

<p>A <em>ray</em>, also known as a half-line, is a line that extends to infinity in only one direction. It can be represented by two vectors: a position vector for the initial point, and a unit vector for the direction. A <em>surface</em> is technically a two-dimensional topological manifold in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 1.26em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.221em 1001.18em 2.321em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="msubsup" id="MathJax-Span-3"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.71em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="texatom" id="MathJax-Span-4"><span class="mrow" id="MathJax-Span-5"><span class="mi" id="MathJax-Span-6" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.749em;"><span class="mn" id="MathJax-Span-7" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 1.002em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">\mathbb{R}^3</script>. For example, the unit ball <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-8" style="width: 10.733em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.104em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.535em 1009.99em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="mi" id="MathJax-Span-10" style="font-family: STIXGeneral-Italic;">B</span><span class="mo" id="MathJax-Span-11" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mo" id="MathJax-Span-12" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">{</span><span class="texatom" id="MathJax-Span-13"><span class="mrow" id="MathJax-Span-14"><span class="munderover" id="MathJax-Span-15"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-16" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-17" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-18" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">∈</span><span class="msubsup" id="MathJax-Span-19" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.71em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="texatom" id="MathJax-Span-20"><span class="mrow" id="MathJax-Span-21"><span class="mi" id="MathJax-Span-22" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.749em;"><span class="mn" id="MathJax-Span-23" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-24" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">:</span><span class="mo" id="MathJax-Span-25" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">‖</span><span class="texatom" id="MathJax-Span-26"><span class="mrow" id="MathJax-Span-27"><span class="munderover" id="MathJax-Span-28"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-30" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-31" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-32" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">≤</span><span class="mn" id="MathJax-Span-33" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">1</span><span class="mo" id="MathJax-Span-34" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>B</mi><mo>=</mo><mo fence="false" stretchy="false">{</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup><mo>:</mo><mo fence="false" stretchy="false">‖</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo fence="false" stretchy="false">‖</mo><mo>≤</mo><mn>1</mn><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">B=\{\vec{x}\in\mathbb{R}^3:\lVert\vec{x}\rVert\le1\}</script> is a solid, not a surface, but its boundary, the (hollow) unit sphere <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2202;&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-35" style="width: 11.205em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.576em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.535em 1010.46em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Regular;">∂</span><span class="mi" id="MathJax-Span-38" style="font-family: STIXGeneral-Italic;">B</span><span class="mo" id="MathJax-Span-39" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mo" id="MathJax-Span-40" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">{</span><span class="texatom" id="MathJax-Span-41"><span class="mrow" id="MathJax-Span-42"><span class="munderover" id="MathJax-Span-43"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-44" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-45" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-46" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">∈</span><span class="msubsup" id="MathJax-Span-47" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.71em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="texatom" id="MathJax-Span-48"><span class="mrow" id="MathJax-Span-49"><span class="mi" id="MathJax-Span-50" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.749em;"><span class="mn" id="MathJax-Span-51" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-52" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">:</span><span class="mo" id="MathJax-Span-53" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">‖</span><span class="texatom" id="MathJax-Span-54"><span class="mrow" id="MathJax-Span-55"><span class="munderover" id="MathJax-Span-56"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-57" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-58" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-59" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-60" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mn" id="MathJax-Span-61" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">1</span><span class="mo" id="MathJax-Span-62" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">∂</mi><mi>B</mi><mo>=</mo><mo fence="false" stretchy="false">{</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup><mo>:</mo><mo fence="false" stretchy="false">‖</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo fence="false" stretchy="false">‖</mo><mo>=</mo><mn>1</mn><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">\partial B=\{\vec{x}\in\mathbb{R}^3:\lVert\vec{x}\rVert = 1\}</script> <em>is</em> a surface. This may seem like a pointless distinction since you can’t tell if the sphere is hollow or not from an image, but it’s worthwhile to keep in mind that you must explicitly model the surface of an object. If you leave a hole in the panelling, the ray tracer will be able to see the interior of a hollow shell.</p>

<p>There is no limit to the kinds of surfaces we could dream up. I’m going to use planes and spheres as examples, but why stop there—what about the cylinder, torus, <a href="http://en.wikipedia.org/wiki/Gabriel&#39;s_Horn">Gabriel’s Horn</a>, … ? In practice, most rendering engines stop even earlier, before the sphere. Instead of implementing special procedures to handle every kind of mathematical surface, they deal only with triangular and quadrilateral sections of planes (commonly referred to as “tris” and “quads”). All surfaces can be approximated by a <em>mesh</em> of these small polygons. Although a perfect sphere looks better and is computationally cheaper than a spherical mesh with a high polygon count, in general it’s not worth the effort because perfect mathematical objects are rare. In fact, it’s often the imperfections—even photographic flaws such as chromatic aberration—that make a render photorealistic. On the other hand, a “too perfect” image immediately arouses suspicion.</p>

<figure>
	
<svg viewBox="0 0 558 252" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.414"><g stroke="#000"><path d="M432 251l-75-25-25-25-15-25-7.5-25-2.5-25 2.5-25 7.5-25 15-25 25-25 75-25 75 25 25 25 15 25 7.5 25 2.5 25-2.5 25-7.5 25-15 25-25 25-75 25z" fill="#ebebeb"></path><path d="M307 126h250m-247.5-25h245M317 76h230M332 51h200M357 26h150M309.5 151h245M317 176h230m-215 25h200m-175 25h150" fill="none"></path><g fill="none"><path d="M432 1l21 25 7 25 4.2 25 2.1 25 .7 25-.7 25-2.1 25-4.2 25-7 25-21 25"></path><path d="M432 1l39 25 13 25 7.8 25 3.9 25 1.3 25-1.3 25-3.9 25-7.8 25-13 25-39 25"></path><path d="M432 1l55.2 25 18.4 25 11.04 25 5.52 25 1.84 25-1.84 25-5.52 25-11.04 25-18.4 25-55.2 25"></path><path d="M432 1l67.2 25 22.4 25 13.44 25 6.72 25 2.24 25-2.24 25-6.72 25-13.44 25-22.4 25-67.2 25"></path></g><g fill="none"><path d="M432 1l-21 25-7 25-4.2 25-2.1 25-.7 25 .7 25 2.1 25 4.2 25 7 25 21 25"></path><path d="M432 1l-39 25-13 25-7.8 25-3.9 25-1.3 25 1.3 25 3.9 25 7.8 25 13 25 39 25"></path><path d="M432 1l-55.2 25-18.4 25-11.04 25-5.52 25-1.84 25 1.84 25 5.52 25 11.04 25 18.4 25 55.2 25"></path><path d="M432 1l-67.2 25-22.4 25-13.44 25-6.72 25-2.24 25 2.24 25 6.72 25 13.44 25 22.4 25 67.2 25"></path></g><path d="M432 1v250" fill="none"></path><circle cx="126" cy="126" r="125" fill="#ebebeb"></circle></g></svg>

	
		<figcaption>Side view of true sphere (left) and low-poly mesh approximation (right)</figcaption>
	
</figure>


<p>All that being said, I’m sticking with planes and spheres because that’s what I used in Luminosity. We can describe a plane by its normal vector and a scalar, as in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-63" style="width: 8.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.453em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.535em 1008.34em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-64"><span class="mo" id="MathJax-Span-65" style="font-family: STIXGeneral-Regular;">{</span><span class="texatom" id="MathJax-Span-66"><span class="mrow" id="MathJax-Span-67"><span class="munderover" id="MathJax-Span-68"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-69" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-70" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-71" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">∈</span><span class="msubsup" id="MathJax-Span-72" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.71em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="texatom" id="MathJax-Span-73"><span class="mrow" id="MathJax-Span-74"><span class="mi" id="MathJax-Span-75" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.749em;"><span class="mn" id="MathJax-Span-76" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-77" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">:</span><span class="texatom" id="MathJax-Span-78" style="padding-left: 0.316em;"><span class="mrow" id="MathJax-Span-79"><span class="munderover" id="MathJax-Span-80"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-81" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-82" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-83" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-84" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-85"><span class="munderover" id="MathJax-Span-86"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-87" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-88" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-89" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mi" id="MathJax-Span-90" style="font-family: STIXGeneral-Italic; padding-left: 0.316em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span class="mo" id="MathJax-Span-91" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup><mo>:</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow><mo>=</mo><mi>d</mi><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">\{\vec{x}\in\mathbb{R}^3:\vec{x}\cdot\hat{n}=d\}</script>. Similarly, a sphere is defined by the position of its centre and its radius: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-92" style="width: 10.261em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.672em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.535em 1009.55em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-93"><span class="mo" id="MathJax-Span-94" style="font-family: STIXGeneral-Regular;">{</span><span class="texatom" id="MathJax-Span-95"><span class="mrow" id="MathJax-Span-96"><span class="munderover" id="MathJax-Span-97"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-98" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-99" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-100" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">∈</span><span class="msubsup" id="MathJax-Span-101" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 1.181em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.71em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="texatom" id="MathJax-Span-102"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Regular;">ℝ</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.749em;"><span class="mn" id="MathJax-Span-105" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">3</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-106" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">:</span><span class="mo" id="MathJax-Span-107" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">‖</span><span class="texatom" id="MathJax-Span-108"><span class="mrow" id="MathJax-Span-109"><span class="munderover" id="MathJax-Span-110"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-112" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-113" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-114" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-115"><span class="munderover" id="MathJax-Span-116"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-117" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-118" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-119" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-120" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mi" id="MathJax-Span-121" style="font-family: STIXGeneral-Italic; padding-left: 0.316em;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span class="mo" id="MathJax-Span-122" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">{</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>∈</mo><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow><mn>3</mn></msup><mo>:</mo><mo fence="false" stretchy="false">‖</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><mo fence="false" stretchy="false">‖</mo><mo>=</mo><mi>r</mi><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">\{\vec{x}\in\mathbb{R}^3:\lVert\vec{x}-\vec{c}\rVert=r\}</script>. These position vectors are all relative to some global origin for the scene.</p>

<h1 id="cameras">Cameras</h1>

<p>The role of the camera is to assign a ray to each pixel of the image. There are two main ways of doing this. First, there are <em>orthographic</em> cameras, where all rays are parallel to each other and normal to the imaginary sensor rectangle. This means that objects do not seem bigger or smaller when they move closer or farther from the camera, which is obviously not how real cameras or eyes work. However, the orthographic projection is useful for practical (rather than aesthetic) reasons, for example in CAD software. The other main type of camera is the <em>perspective camera</em>, where in addition to the sensor rectangle there is a focal point behind its centre. The focal point can be described either by a focal length or an angle of view; longer focal lengths correspond to narrower angles. The direction of each ray is determined by the line passing through the focal point and the pixel. This means the rays diverge as they go out, encompassing an increasing area, which is why an object of constant size appears smaller when it is further away—it takes up a smaller fraction of the cross section of rays that ultimately converge on the focal point.</p>

<figure>
	
<svg viewBox="0 0 642 256" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-miterlimit="1.414"><path d="M2 73.382v120l180 49.245v-120L2 73.382z" fill="#eee" stroke-width="2" stroke="#000"></path><path d="M12 76.118v120M22 78.854v120M32 81.59v120M42 84.326v120M2 183.382l180 49.245M52 87.06v120M2 173.382l180 49.245M62 89.797v120M2 163.382l180 49.245M72 92.533v120m-70-59.15l180 49.244M82 95.27v120M2 143.382l180 49.245M92 98.005v120M2 133.382l180 49.245m-80-81.887v120M2 123.382l180 49.245m-70-69.15v120M2 113.38l180 49.245m-60-56.415v120M2 103.382l180 49.245m-50-43.68v120M2 93.383l180 49.245m-40-30.943v120M2 83.382l180 49.245m-30-18.207v120m10-117.264v120m10-117.264v120" fill="none" stroke="#888"></path><path d="M7 79.75l90-65.377M7 79.75l90-65.377M17 82.486l90-65.378M17 82.486l90-65.378M27 85.222l90-65.378M27 85.222l90-65.378M37 87.957l90-65.377M37 87.957l90-65.377M47 90.693l90-65.377M47 90.693l90-65.377M57 93.43l90-65.378M57 93.43l90-65.378M67 96.165l90-65.377M67 96.165l90-65.377M77 98.9l90-65.377M77 98.9l90-65.377m-80 68.114l90-65.377m-90 65.377l3.553-2.58L177 36.26m-80 68.113l90-65.377m-90 65.377l90-65.377m-80 68.112l90-65.377m-90 65.38l90-65.373m-80 68.114l90-65.377m-90 65.377l90-65.38m-80 68.11l90-65.375m-90 65.377l90-65.375m-80 68.113l90-65.376m-90 65.378l90-65.377m-80 68.113l90-65.377m-80 68.116l90-65.378m-80 68.116l90-65.377m-80 68.113l90-65.378m-90 75.38l90-65.378m-90 75.378l90-65.377m-90 75.378l90-65.376m-90 75.377l90-65.376m-90 75.377l90-65.376m-90 75.376l90-65.377m-90 75.38l90-65.378m-90 75.378l90-65.375m-90 75.378l90-65.376m-90 75.378l90-65.377m-90 75.378l90-65.376" fill="none" stroke="#c20"></path><path d="M375 65.21v120l180 49.245v-120L375 65.21z" fill="#eee" stroke-width="2" stroke="#000"></path><path d="M385 67.945v120M395 70.68v120m10-117.263v120m10-117.264v120m-40-20.943l180 49.245M425 78.89v120m-50-33.68l180 49.245M435 81.625v120m-60-46.415l180 49.245M445 84.36v120m-70-59.15l180 49.245M455 87.095v120m-80-71.885l180 49.245m-90-94.623v120m-90-84.622l180 49.245m-80-81.887v120M375 115.21l180 49.245m-70-69.15v120M375 105.21l180 49.245M495 98.04v120M375 95.21l180 49.245m-50-43.68v120M375 85.21l180 49.245m-40-30.945v120M375 75.21l180 49.245m-30-18.208v120m10-117.264v120m10-117.263v120" fill="none" stroke="#888"></path><path d="M326.48 250.455l269.31-195.63m-269.31 195.63l74.474-248.91m-74.474 248.91L414.954 5.317M326.48 250.455L428.948 9.34M326.48 250.455L443.693 13.28M326.48 250.455L457.147 17.123M326.48 250.455L471.33 20.98M326.48 250.455L484.67 24.71 326.48 250.454zm0 0L498.948 28.45M326.48 250.455l186.715-218.15M326.48 250.455l200.015-214.62M326.48 250.455L540.7 39.75M326.48 250.455L553.79 43.33M326.48 250.455l242.857-202.94M326.48 250.455l256.87-199.07m-256.87 199.07l284.677-191.63M326.48 250.455L624.61 62.84M326.48 250.455l312.554-183.18M326.48 250.455L639.056 79.848M326.48 250.455L639.615 93.552M326.48 250.455l313.172-142.91M326.48 250.455l312.522-128.633M326.48 250.455l312.768-114.74M326.48 250.455L639.32 148.87M326.48 250.455l312.575-86.702M326.48 250.455l312.766-72.762M326.48 250.455l312.863-58.526M326.48 250.45l312.985-44.808m-312.985 44.81l312.83-30.79" fill="none" stroke="#c20"></path><circle cx="326" cy="250.455" r="5"></circle><path d="M555 234.455l-228.52 16L375 65.21" fill="none" stroke-width="2" stroke="#000"></path><path d="M555 114.455l-228.52 136 48.52-65" fill="none" stroke-width="2" stroke="#000"></path></svg>

	
		<figcaption>Rays leaving pixels of an orthographic camera (left) and perspective camera (right)</figcaption>
	
</figure>


<h1 id="intersections">Intersections</h1>

<p>At the heart of the ray tracer is the intersection routine. We need to calculate the point of intersection made by a ray and a surface, which amounts to solving a system of two equations. The ray tracer will find millions of intersections in the course of rendering a single image, but we only need to write one function per type of surface.</p>

<p>We represent the ray by the equation <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-123" style="width: 4.444em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.653em 1004.17em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-124"><span class="texatom" id="MathJax-Span-125"><span class="mrow" id="MathJax-Span-126"><span class="munderover" id="MathJax-Span-127"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-128" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-129" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-130" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="texatom" id="MathJax-Span-131" style="padding-left: 0.316em;"><span class="mrow" id="MathJax-Span-132"><span class="munderover" id="MathJax-Span-133"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-134" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-135" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-136" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-137" style="font-family: STIXGeneral-Italic; padding-left: 0.238em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-138"><span class="mrow" id="MathJax-Span-139"><span class="munderover" id="MathJax-Span-140"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-141" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-142" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.085em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>x</mi><mo stretchy="false">→</mo></mover></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-6">\vec{x}=\vec{p}+t\hat{v}</script> for all <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2265;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-143" style="width: 2.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.085em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1002.05em 2.754em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-144"><span class="mi" id="MathJax-Span-145" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-146" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">≥</span><span class="mn" id="MathJax-Span-147" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.165em; border-left: 0px solid; width: 0px; height: 0.919em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>≥</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-7">t \ge 0</script>. To find the point of intersection, we equate this to a general point on the surface and then solve for <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-148" style="width: 0.316em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.277em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.849em 1000.28em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-149"><span class="mi" id="MathJax-Span-150" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">t</script>. For the plane, we have <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-151" style="width: 6.566em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.173em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.653em 1006.17em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-152"><span class="mo" id="MathJax-Span-153" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="munderover" id="MathJax-Span-156"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-157" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-158" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-159" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-160" style="font-family: STIXGeneral-Italic; padding-left: 0.238em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="munderover" id="MathJax-Span-163"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-164" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-165" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-166" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-167" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-168" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-169"><span class="munderover" id="MathJax-Span-170"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-171" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-172" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-173" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mi" id="MathJax-Span-174" style="font-family: STIXGeneral-Italic; padding-left: 0.316em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.085em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow><mo>=</mo><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">(\vec{p}+t\hat{v})\cdot\hat{n}=d</script>. Rearranging this, we get the solution</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-175" style="width: 6.016em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.662em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(0.985em 1005.58em 3.343em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-176"><span class="mi" id="MathJax-Span-177" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-178" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mfrac" id="MathJax-Span-179" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 3.579em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.147em 1003.42em 4.326em -999.998em); top: -4.676em; left: 50%; margin-left: -1.728em;"><span class="mrow" id="MathJax-Span-180"><span class="mi" id="MathJax-Span-181" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span class="mo" id="MathJax-Span-182" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-183" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-184"><span class="munderover" id="MathJax-Span-185"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-186" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-187" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-188" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-189" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-190"><span class="munderover" id="MathJax-Span-191"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-192" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-193" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(3.186em 1001.69em 4.129em -999.998em); top: -3.339em; left: 50%; margin-left: -0.863em;"><span class="mrow" id="MathJax-Span-194"><span class="texatom" id="MathJax-Span-195"><span class="mrow" id="MathJax-Span-196"><span class="munderover" id="MathJax-Span-197"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-198" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-199" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-200" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-201" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-202"><span class="munderover" id="MathJax-Span-203"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-204" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-205" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(0.867em 1003.58em 1.181em -999.998em); top: -1.295em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 3.579em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.063em;"></span></span></span></span><span class="mo" id="MathJax-Span-206" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.79em; border-left: 0px solid; width: 0px; height: 2.335em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>t</mi><mo>=</mo><mfrac><mrow><mi>d</mi><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow></mrow><mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow></mrow></mfrac><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-10">t = \frac{d-\vec{p}\cdot\hat{n}}{\hat{v}\cdot\hat{n}}.</script></p>

<p>If the answer is negative, then the ray is directed away from the plane, so the other half of the half-line is intersecting the plane. I’ve chosen to treat surfaces as double-sided, meaning there is no distinction between the inside and the outside as far as intersection goes. As a result, it shouldn’t matter if we negate the normal vector. If we negate <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-207" style="width: 0.552em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.378em 1000.47em 2.321em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-208"><span class="texatom" id="MathJax-Span-209"><span class="mrow" id="MathJax-Span-210"><span class="munderover" id="MathJax-Span-211"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-212" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-213" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.835em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-11">\hat{n}</script>, then we have to negate <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-214" style="width: 0.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1000.55em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-215"><span class="mi" id="MathJax-Span-216" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.835em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">d</script> as well to represent the same plane; and if we make these substitutions in the equation for <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-217" style="width: 0.316em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.277em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.849em 1000.28em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-218"><span class="mi" id="MathJax-Span-219" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">t</script>, the negatives cancel out, as expected. Also, we must be careful not to divide by zero when <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-220" style="width: 3.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.5em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.692em 1003.46em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-221"><span class="texatom" id="MathJax-Span-222"><span class="mrow" id="MathJax-Span-223"><span class="munderover" id="MathJax-Span-224"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-225" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-226" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-227" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-228" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-229"><span class="munderover" id="MathJax-Span-230"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-231" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-232" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-233" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mn" id="MathJax-Span-234" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.835em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-14">\hat{v}\cdot\hat{n}=0</script>, which occurs when the ray is parallel to the plane.<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="http://mitchellkember.com/blog/post/ray-tracer/#fn:2">2</a></sup></p>

<p>The ray–sphere intersection is a bit harder. We begin by substituting the equation of the ray: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-235" style="width: 7.195em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.763em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.653em 1006.76em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-236"><span class="mo" id="MathJax-Span-237" style="font-family: STIXGeneral-Regular;">‖</span><span class="texatom" id="MathJax-Span-238"><span class="mrow" id="MathJax-Span-239"><span class="munderover" id="MathJax-Span-240"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-242" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-243" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-244" style="font-family: STIXGeneral-Italic; padding-left: 0.238em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-245"><span class="mrow" id="MathJax-Span-246"><span class="munderover" id="MathJax-Span-247"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-248" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-249" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-250" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-251" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-252"><span class="munderover" id="MathJax-Span-253"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-254" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-255" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-256" style="font-family: STIXGeneral-Regular;">‖</span><span class="mo" id="MathJax-Span-257" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mi" id="MathJax-Span-258" style="font-family: STIXGeneral-Italic; padding-left: 0.316em;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.085em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo fence="false" stretchy="false">‖</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><mo fence="false" stretchy="false">‖</mo><mo>=</mo><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">\lVert\vec{p}+t\hat{v}-\vec{c}\rVert=r</script>. Squaring both sides and using the dot product, we get <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-259" style="width: 13.013em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.266em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.574em 1012.27em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-260"><span class="mo" id="MathJax-Span-261" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-262"><span class="mrow" id="MathJax-Span-263"><span class="munderover" id="MathJax-Span-264"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-265" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-266" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-267" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-268" style="font-family: STIXGeneral-Italic; padding-left: 0.238em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-269"><span class="mrow" id="MathJax-Span-270"><span class="munderover" id="MathJax-Span-271"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-272" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-273" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-274" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-275" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-276"><span class="munderover" id="MathJax-Span-277"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-279" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-280" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-281" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="mo" id="MathJax-Span-282" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">(</span><span class="texatom" id="MathJax-Span-283"><span class="mrow" id="MathJax-Span-284"><span class="munderover" id="MathJax-Span-285"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-286" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-287" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-288" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mi" id="MathJax-Span-289" style="font-family: STIXGeneral-Italic; padding-left: 0.238em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-290"><span class="mrow" id="MathJax-Span-291"><span class="munderover" id="MathJax-Span-292"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-293" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-294" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-295" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-296" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-297"><span class="munderover" id="MathJax-Span-298"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-299" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-300" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-301" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-302" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="msubsup" id="MathJax-Span-303" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-304" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.361em; left: 0.474em;"><span class="mn" id="MathJax-Span-305" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-16">(\vec{p} + t\hat{v}-\vec{c})\cdot(\vec{p} + t\hat{v}-\vec{c})=r^2</script>, which reduces to the quadratic <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;&amp;#x2016;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-306" style="width: 14.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.642em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.574em 1013.64em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-307"><span class="msubsup" id="MathJax-Span-308"><span style="display: inline-block; position: relative; width: 0.788em; height: 0px;"><span style="position: absolute; clip: rect(3.343em 1000.32em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-309" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.361em; left: 0.356em;"><span class="mn" id="MathJax-Span-310" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-311" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mn" id="MathJax-Span-312" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">2</span><span class="texatom" id="MathJax-Span-313"><span class="mrow" id="MathJax-Span-314"><span class="munderover" id="MathJax-Span-315"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-316" style="font-family: STIXGeneral-Italic;">v</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-317" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-318" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="mo" id="MathJax-Span-319" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">(</span><span class="texatom" id="MathJax-Span-320"><span class="mrow" id="MathJax-Span-321"><span class="munderover" id="MathJax-Span-322"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-323" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-324" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-325" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-326" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-327"><span class="munderover" id="MathJax-Span-328"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-329" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-330" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-331" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-332" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-333" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">+</span><span class="mo" id="MathJax-Span-334" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">‖</span><span class="texatom" id="MathJax-Span-335"><span class="mrow" id="MathJax-Span-336"><span class="munderover" id="MathJax-Span-337"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-338" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.041em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-339" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-340" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="texatom" id="MathJax-Span-341" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-342"><span class="munderover" id="MathJax-Span-343"><span style="display: inline-block; position: relative; width: 0.434em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-344" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.007em; left: 0.002em;"><span style="height: 0em; vertical-align: 0em; width: 0.474em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-345" style="font-family: STIXGeneral-Regular;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="msubsup" id="MathJax-Span-346"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.186em 1000.39em 4.326em -999.998em); top: -4.007em; left: 0em;"><span class="mo" id="MathJax-Span-347" style="font-family: STIXGeneral-Regular;">‖</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.361em; left: 0.513em;"><span class="mn" id="MathJax-Span-348" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-349" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="msubsup" id="MathJax-Span-350" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-351" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.361em; left: 0.474em;"><span class="mn" id="MathJax-Span-352" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>t</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mover><mi>v</mi><mo stretchy="false">^</mo></mover></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><mo stretchy="false">)</mo><mi>t</mi><mo>+</mo><mo fence="false" stretchy="false">‖</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>p</mi><mo stretchy="false">→</mo></mover></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>c</mi><mo stretchy="false">→</mo></mover></mrow><msup><mo fence="false" stretchy="false">‖</mo><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-17">t^2 + 2\hat{v}\cdot(\vec{p}-\vec{c})t + \lVert\vec{p}-\vec{c}\rVert^2=r^2</script>. The quadratic formula gives zero, one, or two solutions, since the ray either misses the sphere, touches a point tangentially, or enters by one point and exits by another. Again, we do not allow negative solutions.</p>

<figure>
	
<svg viewBox="0 0 597 383" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-miterlimit="1.414"><circle cx="102" cy="141" r="100" fill="none" stroke-width="2" stroke="#888"></circle><text x="85" y="156.85" font-family="Concourse T3" font-size="50" font-weight="300" fill="#888">A</text><circle cx="306" cy="281" r="100" fill="none" stroke-width="2" stroke="#888"></circle><circle cx="495" cy="119" r="100" fill="none" stroke-width="2" stroke="#888"></circle><path d="M6 354.03L557 3.034m-9.62.754l10.69-1.656-4.29 9.292" fill="none" stroke-width="2" stroke="#000"></path><circle cx="253" cy="197" r="5" fill="#c20"></circle><circle cx="396" cy="106" r="5" fill="#c20"></circle><circle cx="525" cy="24" r="5" fill="#c20"></circle><text x="292" y="296.85" font-family="Concourse T3" font-size="50" font-weight="300" fill="#888">B</text><text x="478.5" y="134.85" font-family="Concourse T3" font-size="50" font-weight="300" fill="#888">C</text></svg>

	
		<figcaption>Zero intersections (A), one intersection (B), and two intersections (C)</figcaption>
	
</figure>


<h1 id="light-and-shadow">Light and shadow</h1>

<p>Once we’ve found the closest intersection, we calculate the light contribution due to each light source. There are many ways of doing this; I’m going to use the Lambert shading algorithm for its simplicity. It models diffuse reflection by</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-353" style="width: 6.055em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.702em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.496em 1005.66em 2.793em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-354"><span class="msubsup" id="MathJax-Span-355"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-356" style="font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.316em;"><span class="mi" id="MathJax-Span-357" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">D</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-358" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mi" id="MathJax-Span-359" style="font-family: STIXGeneral-Italic; padding-left: 0.316em;">R</span><span class="msubsup" id="MathJax-Span-360"><span style="display: inline-block; position: relative; width: 0.788em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-361" style="font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.316em;"><span class="mi" id="MathJax-Span-362" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="texatom" id="MathJax-Span-363"><span class="mrow" id="MathJax-Span-364"><span class="munderover" id="MathJax-Span-365"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.55em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-366" style="font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.243em; left: 0.159em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-367" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-368" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">⋅</span><span class="texatom" id="MathJax-Span-369" style="padding-left: 0.238em;"><span class="mrow" id="MathJax-Span-370"><span class="munderover" id="MathJax-Span-371"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-372" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-373" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-374" style="font-family: STIXGeneral-Regular;">,</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.206em; border-left: 0px solid; width: 0px; height: 1.21em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>I</mi><mi>D</mi></msub><mo>=</mo><mi>R</mi><msub><mi>I</mi><mi>L</mi></msub><mrow class="MJX-TeXAtom-ORD"><mover><mi>L</mi><mo stretchy="false">^</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow><mo>,</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-18">I_D = RI_L\hat{L}\cdot\hat{n},</script></p>

<p>where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 0.67em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.631em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1000.59em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="mi" id="MathJax-Span-377" style="font-family: STIXGeneral-Italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.794em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">R</script> is the reflectivity of the surface material (zero for black, one for white), <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-378" style="width: 0.827em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.788em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.417em 1000.79em 2.478em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-379"><span class="msubsup" id="MathJax-Span-380"><span style="display: inline-block; position: relative; width: 0.788em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-381" style="font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.316em;"><span class="mi" id="MathJax-Span-382" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.206em; border-left: 0px solid; width: 0px; height: 0.919em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>L</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-20">I_L</script> is the intensity of the light at that point, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-383" style="width: 0.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.181em 1000.55em 2.321em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-384"><span class="texatom" id="MathJax-Span-385"><span class="mrow" id="MathJax-Span-386"><span class="munderover" id="MathJax-Span-387"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.55em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-388" style="font-family: STIXGeneral-Italic;">L<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.243em; left: 0.159em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-389" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 1.044em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>L</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-21">\hat{L}</script> goes from the point towards the light source, and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x005E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-390" style="width: 0.552em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.378em 1000.47em 2.321em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-391"><span class="texatom" id="MathJax-Span-392"><span class="mrow" id="MathJax-Span-393"><span class="munderover" id="MathJax-Span-394"><span style="display: inline-block; position: relative; width: 0.513em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.47em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-395" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.047em; left: 0.081em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-396" style="font-family: STIXGeneral-Regular;">̂&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.234em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.835em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>n</mi><mo stretchy="false">^</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-22">\hat{n}</script> is normal to the surface. The resulting <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-397" style="width: 0.985em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.417em 1000.91em 2.478em -999.998em); top: -2.199em; left: 0em;"><span class="mrow" id="MathJax-Span-398"><span class="msubsup" id="MathJax-Span-399"><span style="display: inline-block; position: relative; width: 0.906em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1000.39em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-400" style="font-family: STIXGeneral-Italic;">I<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -3.85em; left: 0.316em;"><span class="mi" id="MathJax-Span-401" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">D</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.203em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.206em; border-left: 0px solid; width: 0px; height: 0.919em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>I</mi><mi>D</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-23">I_D</script> is the diffuse light scattered in all directions from the point. We calculate the intensity for each colour channel independently, so in RGB we have to calculate three products. Notice that the dot product in the Lambert equation causes maximum reflectance when the light source is straight on like the midday sun, and minimum reflectance when it is like a sunrise or sunset. If the result is negative, we treat it as zero, because the light rays are coming from behind the surface.</p>

<p>To handle shadows, we create a ray from the point on the surface directed towards the light source. If there is an intersection before the light source, then the point is in the shade. That’s it! Because we are modelling light the way it works physically, shadow calculations are beautifully simple. The shadows we get are very crisp, which can be a good thing—but shadows are often blurry around the edges, and we may wish to capture that. The issue here is with our light sources.</p>

<p>There are three common models for light sources. The first is a point source, whose intensity follows an inverse-square falloff. The second is called an infinite source or directional light, and it consists of parallel rays of uniform intensity coming from infinitely far away. The third is a spotlight, which is like a point source but limited to a conic volume, and possibly fading out as the rays get further away its principal direction. These are all useful in lighting three-dimensional scenes, but they are not very realistic. For example, a light bulb appears to be a point source, but it is really better modelled as infinitely many point sources of infinitesimal intensity distributed throughout the volume of a bulb. We can achieve blurry shadows this way, at the cost of much more complex calculations.</p>

<h1 id="exposure-and-gamma-correction">Exposure and gamma correction</h1>

<p>Once we’ve calculated the colours of all the pixels, we’re still not done. The values we write to disk will ultimately be in the 8-bit-per-channel format, which divides each channel into 256 shades. We need to map the intensities to the range [0,255] and round to the nearest integer—this is where we control the <em>exposure</em> of the image. There are two simple ways we can do this: by clipping all colours greater than some arbitrary maximum, or by moving the white point to make all intensities fit in the target range.</p>

<figure>
	
<svg viewBox="0 0 708 210" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-miterlimit="1.414"><path d="M24 87.465s30.623-57 62-57 54.678 106 78 106c23.323 0 33.564-49 58-49s23.148 114 102 114" fill="none" stroke-width="2" stroke="#c20"></path><path d="M24 1.465v200h300m-308-130h8m-8 130h8" fill="none" stroke-width="2" stroke="#000"></path><text x="4.727" y="78.84" font-family="Concourse T3" font-size="20" font-weight="300">1</text><text x=".727" y="208.84" font-family="Concourse T3" font-size="20" font-weight="300">0</text><path d="M35 71.96h87" fill="none" stroke-width="2" stroke-dasharray="4 2 0 0" stroke="#c20"></path><path d="M406 87.465s30.623-57 62-57 54.678 106 78 106c23.323 0 33.564-49 58-49s23.148 114 102 114" fill="none" stroke-width="2" stroke="#c20"></path><path d="M406 113.465s30.623-44 62-44 54.678 81.825 78 81.825c23.323 0 33.564-37.825 58-37.825s23.148 88 102 88" fill="none" stroke-width="2" stroke-dasharray="4 2 0 0" stroke="#c20"></path><path d="M406 1.465v200h300m-308-130h8m-8 130h8" fill="none" stroke-width="2" stroke="#000"></path><text x="386.727" y="78.84" font-family="Concourse T3" font-size="20" font-weight="300">1</text><text x="382.727" y="208.84" font-family="Concourse T3" font-size="20" font-weight="300">0</text></svg>

	
		<figcaption>Exposure control by clipping (left) and by scaling intensities down (right)</figcaption>
	
</figure>


<p>Finally, before rounding and storing the bytes, we need to apply <em>gamma correction</em>. It turns out that the human eye perceives light in a nonlinear way: we can distinguish many more colours in the darker end of the spectrum than in the lighter end. For this reason, it makes sense to devote more than half of the 256 values to intensities under 50% grey. We do this by gamma encoding, which means applying a function of the form <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x21A6;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-402" style="width: 3.029em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.832em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1002.83em 2.636em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-403"><span class="mi" id="MathJax-Span-404" style="font-family: STIXGeneral-Italic;">c</span><span class="mo" id="MathJax-Span-405" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">↦</span><span class="msubsup" id="MathJax-Span-406" style="padding-left: 0.316em;"><span style="display: inline-block; position: relative; width: 0.827em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-407" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.361em; left: 0.434em;"><span class="mi" id="MathJax-Span-408" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.04em; border-left: 0px solid; width: 0px; height: 0.794em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>c</mi><mo stretchy="false">↦</mo><msup><mi>c</mi><mi>γ</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-24">c\mapsto c^\gamma</script> where <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-409" style="width: 2.439em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.282em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1002.16em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-410"><span class="mi" id="MathJax-Span-411" style="font-family: STIXGeneral-Italic;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span class="mo" id="MathJax-Span-412" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">&lt;</span><span class="mn" id="MathJax-Span-413" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.002em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi><mo>&lt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-25">\gamma < 1</script>. Now, it also turns out that the output luminance of CRT monitors varies nonlinearly with the input voltage. By a happy coincidence, it is a gamma function with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-414" style="width: 2.439em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.282em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(1.732em 1002.16em 2.832em -999.998em); top: -2.514em; left: 0em;"><span class="mrow" id="MathJax-Span-415"><span class="mi" id="MathJax-Span-416" style="font-family: STIXGeneral-Italic;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.041em;"></span></span><span class="mo" id="MathJax-Span-417" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">&gt;</span><span class="mn" id="MathJax-Span-418" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.518em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.248em; border-left: 0px solid; width: 0px; height: 1.002em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>γ</mi><mo>&gt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-26">\gamma > 1</script> and it approximates the inverse of our gamma encoding function. So, at least in the early days of television, there was no need to undo the gamma compression—the display did it naturally! Nowadays, we still store images with gamma compression, but the path from RGB value to voltage across an LCD pixel is not so simple.</p>

<figure>
	
<!--?xml version="1.0" standalone="no"?--><svg width="100%" height="100%" viewBox="0 0 720 345" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-miterlimit:1.41421;"><g id="Layer1"><path d="M44.5,304c0,0 0.320907,-88.0117 79.5,-160c70.802,-64.372 220.5,-140 220.5,-140" style="fill:none;stroke-width:2px;stroke:#c20;"></path><path d="M411.906,304c0,0 88.0117,-0.320907 160,-79.5c64.372,-70.802 140,-220.5 140,-220.5" style="fill:none;stroke-width:2px;stroke:#c20;"></path><path d="M44.5,3l-4.26326e-14,300l300,-1.13687e-13" style="fill:none;stroke-width:2px;stroke:#000;"></path><path d="M411.906,3l-5.68434e-14,300l300,-1.13687e-13" style="fill:none;stroke-width:2px;stroke:#000;"></path><path d="M44.5,304l300,-300" style="fill:none;stroke-width:2px;stroke-dasharray:4,2,0,0;stroke:#000;"></path><path d="M411.906,304l300,-300" style="fill:none;stroke-width:2px;stroke-dasharray:4,2,0,0;stroke:#000;"></path><text x="97px" y="334.26px" style="font-family:Concourse T3;font-size:30px;font-weight:300;fill:#000;">ac<tspan x="122.8px 132.1px " y="334.26px 334.26px ">tu</tspan>al luminance</text><text x="486.156px" y="334.26px" style="font-family:Concourse T3;font-size:30px;font-weight:300;fill:#000;">input v<tspan x="565.356px 580.056px 586.956px 595.956px 609.456px " y="334.26px 334.26px 334.26px 334.26px 334.26px ">oltag</tspan>e</text><g transform="matrix(-1.60812e-16,-1,1,-1.60812e-16,-951.842,111.854)"><text x="-159.196px" y="978.602px" style="font-family:Concourse T3;font-size:30px;font-weight:300;fill:#000;">per<tspan x="-121.696px -109.696px " y="978.602px 978.602px ">ce</tspan>iv<tspan x="-76.3958px -62.8958px " y="978.602px 978.602px ">ed</tspan> luminance</text></g><g transform="matrix(-1.60812e-16,-1,1,-1.60812e-16,-567.336,462.16)"><text x="208.21px" y="961.502px" style="font-family:Concourse T3;font-size:30px;font-weight:300;fill:#000;">output luminance</text></g></g></svg>
	
		<figcaption>Gamma encoding (left) and its inverse, gamma decoding (right)</figcaption>
	
</figure>


<p>With Luminosity, I used the ubiquitous sRGB color space. The transformation from linear to sRGB is almost a gamma function, but not quite because it includes a linear part at the beginning to avoid having infinite slope at the origin. We can define it as a piecewise function:</p>

<p><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mtable columnalign=&quot;left left&quot; rowspacing=&quot;.2em&quot; columnspacing=&quot;1em&quot; displaystyle=&quot;false&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;12.92&lt;/mn&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;if&lt;/mtext&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;0.0031308&lt;/mn&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mn&gt;1.055&lt;/mn&gt;&lt;msup&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2.4&lt;/mn&gt;&lt;/mfrac&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.055&lt;/mn&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mtext&gt;otherwise.&lt;/mtext&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo fence=&quot;true&quot; stretchy=&quot;true&quot; symmetric=&quot;true&quot;&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-419" style="width: 20.757em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.577em; height: 0px; font-size: 106%;"><span style="position: absolute; clip: rect(2.478em 1019.58em 5.191em -999.998em); top: -4.086em; left: 0em;"><span class="mrow" id="MathJax-Span-420"><span class="mi" id="MathJax-Span-421" style="font-family: STIXGeneral-Italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.159em;"></span></span><span class="mo" id="MathJax-Span-422" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-423" style="font-family: STIXGeneral-Italic;">c</span><span class="mo" id="MathJax-Span-424" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-425" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">=</span><span class="mrow" id="MathJax-Span-426" style="padding-left: 0.316em;"><span class="mo" id="MathJax-Span-427" style="vertical-align: -0.588em;"><span style="font-family: STIXSizeThreeSym;">{</span></span><span class="mtable" id="MathJax-Span-428" style="padding-right: 0.159em; padding-left: 0.159em;"><span style="display: inline-block; position: relative; width: 15.489em; height: 0px;"><span style="position: absolute; clip: rect(2.518em 1007.12em 5.073em -999.998em); top: -4.007em; left: 0em;"><span style="display: inline-block; position: relative; width: 7.156em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1002.67em 4.169em -999.998em); top: -4.715em; left: 0em;"><span class="mtd" id="MathJax-Span-429"><span class="mrow" id="MathJax-Span-430"><span class="mn" id="MathJax-Span-431" style="font-family: STIXGeneral-Regular;">12.92</span><span class="mi" id="MathJax-Span-432" style="font-family: STIXGeneral-Italic;">c</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(2.832em 1007.12em 4.287em -999.998em); top: -3.221em; left: 0em;"><span class="mtd" id="MathJax-Span-441"><span class="mrow" id="MathJax-Span-442"><span class="mn" id="MathJax-Span-443" style="font-family: STIXGeneral-Regular;">1.055</span><span class="msubsup" id="MathJax-Span-444"><span style="display: inline-block; position: relative; width: 1.496em; height: 0px;"><span style="position: absolute; clip: rect(3.461em 1000.43em 4.129em -999.998em); top: -4.007em; left: 0em;"><span class="mi" id="MathJax-Span-445" style="font-family: STIXGeneral-Italic;">c</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; top: -4.401em; left: 0.434em;"><span class="texatom" id="MathJax-Span-446"><span class="mrow" id="MathJax-Span-447"><span class="mfrac" id="MathJax-Span-448"><span style="display: inline-block; position: relative; width: 0.749em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.54em 1000.2em 4.129em -999.998em); top: -4.322em; left: 50%; margin-left: -0.116em;"><span class="mn" id="MathJax-Span-449" style="font-size: 50%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(3.54em 1000.63em 4.129em -999.998em); top: -3.693em; left: 50%; margin-left: -0.313em;"><span class="mn" id="MathJax-Span-450" style="font-size: 50%; font-family: STIXGeneral-Regular;">2.4</span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(0.867em 1000.75em 1.181em -999.998em); top: -1.217em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.5px solid; width: 0.749em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.063em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-451" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">−</span><span class="mn" id="MathJax-Span-452" style="font-family: STIXGeneral-Regular; padding-left: 0.238em;">0.055</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(2.518em 1007.16em 4.915em -999.998em); top: -4.007em; left: 8.296em;"><span style="display: inline-block; position: relative; width: 7.195em; height: 0px;"><span style="position: absolute; clip: rect(3.225em 1007.16em 4.287em -999.998em); top: -4.715em; left: 0em;"><span class="mtd" id="MathJax-Span-433"><span class="mrow" id="MathJax-Span-434"><span class="mtext" id="MathJax-Span-435" style="font-family: STIXGeneral-Regular;">if</span><span class="mspace" id="MathJax-Span-436" style="height: 0em; vertical-align: 0em; width: 0.316em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-437" style="font-family: STIXGeneral-Italic;">c</span><span class="mo" id="MathJax-Span-438" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">≤</span><span class="mn" id="MathJax-Span-439" style="font-family: STIXGeneral-Regular; padding-left: 0.316em;">0.0031308</span><span class="mo" id="MathJax-Span-440" style="font-family: STIXGeneral-Regular;">;</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span><span style="position: absolute; clip: rect(3.225em 1004.09em 4.129em -999.998em); top: -3.221em; left: 0em;"><span class="mtd" id="MathJax-Span-453"><span class="mrow" id="MathJax-Span-454"><span class="mtext" id="MathJax-Span-455" style="font-family: STIXGeneral-Regular;">otherwise.</span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.011em;"></span></span></span></span><span class="mo" id="MathJax-Span-456"></span></span></span><span style="display: inline-block; width: 0px; height: 4.09em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.081em; border-left: 0px solid; width: 0px; height: 2.71em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo>{</mo><mtable columnalign="left left" rowspacing=".2em" columnspacing="1em" displaystyle="false"><mtr><mtd><mn>12.92</mn><mi>c</mi></mtd><mtd><mtext>if</mtext><mspace width="thickmathspace"></mspace><mi>c</mi><mo>≤</mo><mn>0.0031308</mn><mo>;</mo></mtd></mtr><mtr><mtd><mn>1.055</mn><msup><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mfrac><mn>1</mn><mn>2.4</mn></mfrac></mrow></msup><mo>−</mo><mn>0.055</mn></mtd><mtd><mtext>otherwise.</mtext></mtd></mtr></mtable><mo fence="true" stretchy="true" symmetric="true"></mo></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-27">f(c)=\begin{cases}12.92c & \text{if}\;c \le 0.0031308;\\ 1.055c^{\frac1{2.4}}-0.055 & \text{otherwise.} \end{cases}</script></p>

<h1 id="conclusion">Conclusion</h1>

<p>You now have almost all the tools you need to make a ray tracer. It may seem like a lot, but if you look at the source code for <a href="https://github.com/mk12/luminosity">Luminosity</a> you’ll see that it’s actually pretty short. Once you’ve implemented vectors, rays, surfaces, intersection functions, cameras, exposure and gamma functions, scene parsing, and the image output routine (which is admittedly quite a bit of work altogether), the ray tracing algorithm itself will just be a few lines. After that, there’s still many more features you can work on: oversampling (antialiasing), specular reflection, textures, and normal mapping, to name a few. If you’re still not satisfied with your ray tracer, I recommend reading up on Monte Carlo path tracing—and definitely check out <a href="http://www.kevinbeason.com/smallpt/">smallpt</a>, a global illumination path tracer written in 99 lines!</p>
<div class="footnotes">

<hr>

<ol>
<li id="fn:1">This makes it very easy to parallelize—for example, a quad-core processor could simply have each core working on a different quadrant of the image.
 <a class="footnote-return" href="http://mitchellkember.com/blog/post/ray-tracer/#fnref:1">↩</a></li>
<li id="fn:2">There are either zero or infinity intersections in this case. It makes sense to just return a negative value in both cases, unless you really want to see a paper-thin line when the camera is precisely aligned inside a plane.
 <a class="footnote-return" href="http://mitchellkember.com/blog/post/ray-tracer/#fnref:2">↩</a></li>
</ol>
</div>
</article>

<footer>
	<nav class="page-nav">
	<ul>
		<li id="go-previous"><a href="http://mitchellkember.com/blog/post/chasing-the-infinite/">«&nbsp;New<span>er</span></a></li><li id="go-home-d"><a href="http://mitchellkember.com/">Home</a></li><li id="go-toc"><a href="http://mitchellkember.com/blog/">Blog</a></li><li id="go-next"><a href="http://mitchellkember.com/blog/post/prisoner-dilemma/">Old<span>er</span>&nbsp;»</a></li>
	</ul>
</nav>

</footer>


<script src="./orthographic_and_perspective_cameras_files/MathJax.js" id=""></script>




<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: STIXSizeOneSym, sans-serif;"></div></div></body></html>